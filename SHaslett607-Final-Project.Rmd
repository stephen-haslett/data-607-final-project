---
title: "Property Prices and Crime in NYC"
author: "Stephen Haslett"
date: "12/10/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE, warning=FALSE}
library(RCurl)
library(XML)
library(jsonlite)
library(knitr)
library(kableExtra)
library(tidyverse)
library(tidyr)
library(geosphere)
library(leaflet)
library(plyr)
library(tools)
```


##Objective

For this project, I will investigate the correlation between crime and property prices within NYC's 5 boroughs. The 3 main questions I want to answer are:

1. What is the correlation between crime and property prices in NYC?

2. Do specific types of crime have an affect on property values?

3. As the number of arrests decrease in a borough, do property values increase?

##Data Sources

The 2 main data sources I will use for this project can be found on NYCOpenData (https://opendata.cityofnewyork.us/data/).

I will explore the "NYPD Arrests Data (Historic)" dataset, and will compare this to the "Revised Notice of Property Value (RNOPV)" dataset which contains NYC Department of Finance property evaluation data. Both datasets contain a borough column, so this will be my starting point for correlating the 2 sets of data, and will allow me to start identifying patterns between crime and property prices.

The NYPD Arrests dataset contains information on the types of offenses that were committed prior to the arrest, and so this can be utilized to investigate what affect specific crimes have (if any) on property values. 

#### Fetch the Necessary Data.

The _NYPD Arrests Data (Historic)_ csv file is 2.05 GB, so I decided to obtain the data via NYCOpenData's JSON endpoint to save on memory.

```{r, message=FALSE, warning=FALSE}
crime_data <- fromJSON("https://data.cityofnewyork.us/resource/qgea-i56i.json")
nyc_population <- fromJSON("https://data.cityofnewyork.us/resource/xywu-7bv9.json")
#revised_property_prices <- fromJSON("https://data.cityofnewyork.us/resource/8vgb-zm6e.json")
#glimpse(revised_property_prices)
```

### Cleaning the Data.

#### View the number of columns and rows in the dataset.
```{r, message=FALSE, warning=FALSE}
dim(crime_data)
```

#### Now look at the data structure, and column names.
```{r, message=FALSE, warning=FALSE}
str(crime_data)
```


#### Column names.
```{r, message=FALSE, warning=FALSE}
colnames(crime_data)
```


**We don't need all of the information in the dataset for our analysis, so we take what we need, and leave what we don't.**

```{r, message=FALSE, warning=FALSE}
# Extract the columns with the data that we need.
crime_data_refined <- select(crime_data, rpt_dt, ofns_desc, ofns_desc, law_cat_cd, boro_nm, addr_pct_cd, latitude, longitude, lat_lon)

# Remove NAs from the data.
sapply(crime_data_refined, function(x) sum(is.na(x)))
clean_crime_data <- na.omit(crime_data_refined)
sapply(clean_crime_data, function(x) sum(is.na(x)))

summary(clean_crime_data)
```

#### Look at a sample of the clean data.
```{r, message=FALSE, warning=FALSE}
sample_n(clean_crime_data, 30)
```


### Data Analysis

#### Crime Frequency by Borough.
```{r, message=FALSE, warning=FALSE}
# Count the occurences of a borough name to give us an idea of the crime rate in the borough.
crimes_per_borough <- table(clean_crime_data$boro_nm)
head(crimes_per_borough)
```

#### Bar graph representing crime occurences in each borough.
```{r, message=FALSE, warning=FALSE}
crimes_dataframe <- as.data.frame(crimes_per_borough)
colnames(crimes_dataframe) <- c('Borough', 'Crimes')

# Convert borough names to title case form, and add borough population data so we can calculate crime rates.
crimes_dataframe$Borough = toTitleCase(crimes_dataframe$Borough)
crimes_dataframe

```


